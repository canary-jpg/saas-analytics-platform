{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.11.4", "generated_at": "2026-02-18T17:29:05.509937Z", "invocation_id": "a34d31f4-e796-4c20-86a9-7c2a474ce909", "invocation_started_at": "2026-02-18T17:29:04.615205Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-18T17:29:05.428433Z", "completed_at": "2026-02-18T17:29:05.433369Z"}, {"name": "execute", "started_at": "2026-02-18T17:29:05.433596Z", "completed_at": "2026-02-18T17:29:05.505890Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.07806015014648438, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.saas_analytics.rpt_mrr_movements", "compiled": true, "compiled_code": "\n\nwith mrr_by_month as (\n\n    select * from \"analytics\".\"main\".\"fct_mrr_by_month\"\n\n),\n\n-- Get all months and all users who ever had MRR\nall_months as (\n    select distinct month_date from mrr_by_month\n),\n\nall_users as (\n    select distinct user_id from mrr_by_month\n),\n\n-- Create a complete spine of month-user combinations\nmonth_user_spine as (\n    select \n        m.month_date,\n        u.user_id\n    from all_months m\n    cross join all_users u\n),\n\n-- Get MRR for each month-user, filling in 0 for missing combinations\nuser_mrr_complete as (\n    select\n        s.month_date,\n        s.user_id,\n        coalesce(sum(m.mrr), 0) as mrr_this_month\n    from month_user_spine s\n    left join mrr_by_month m\n        on s.month_date = m.month_date\n        and s.user_id = m.user_id\n    group by s.month_date, s.user_id\n),\n\n-- Get current and prior month MRR for each user\nuser_mrr_current_and_prior as (\n\n    select\n        month_date,\n        user_id,\n        mrr_this_month,\n        lag(mrr_this_month) over (partition by user_id order by month_date) as mrr_last_month,\n        lag(month_date) over (partition by user_id order by month_date) as last_month_date\n\n    from user_mrr_complete\n\n),\n\n-- Classify MRR movement type for each user each month\nmrr_changes as (\n\n    select\n        month_date,\n        user_id,\n        mrr_this_month,\n        mrr_last_month,\n\n        -- change amount\n        mrr_this_month - coalesce(mrr_last_month, 0) as mrr_change,\n\n        -- movement type\n        case\n            -- new customer (no MRR last month, has MRR this month)\n            when (mrr_last_month is null or mrr_last_month = 0) and mrr_this_month > 0 then 'new'\n            \n            -- churned (had MRR last month, none this month)\n            when mrr_last_month > 0 and mrr_this_month = 0 then 'churn'\n            \n            -- expansion (increased MRR)\n            when mrr_last_month > 0 and mrr_this_month > mrr_last_month then 'expansion'\n            \n            -- contraction (decreased MRR)\n            when mrr_last_month > 0 and mrr_this_month > 0 and mrr_this_month < mrr_last_month then 'contraction'\n            \n            -- retained (same MRR)\n            when mrr_last_month > 0 and mrr_this_month = mrr_last_month then 'retained'\n            \n            -- no MRR in either month - skip these\n            else 'inactive'\n        end as movement_type,\n\n        -- check for reactivation (churned before, now back)\n        case\n            when mrr_last_month is not null \n                and mrr_last_month = 0 \n                and last_month_date = month_date - interval '1 month'\n                and mrr_this_month > 0\n            then true\n            else false\n        end as is_reactivation\n\n    from user_mrr_current_and_prior\n    where mrr_last_month is not null  -- skip first month for each user\n\n),\n\n-- Aggregate movements by month\nmonthly_movements as (\n\n    select\n        month_date,\n\n        -- customer counts (exclude 'inactive' users)\n        count(distinct case when movement_type = 'new' then user_id end) as new_customers,\n        count(distinct case when movement_type = 'expansion' then user_id end) as expansion_customers,\n        count(distinct case when movement_type = 'contraction' then user_id end) as contraction_customers,\n        count(distinct case when movement_type = 'churn' then user_id end) as churned_customers,\n        count(distinct case when movement_type = 'retained' then user_id end) as retained_customers,\n        count(distinct case when is_reactivation then user_id end) as reactivated_customers,\n\n        -- MRR amounts\n        sum(case when movement_type = 'new' then mrr_this_month else 0 end) as new_mrr,\n        sum(case when movement_type = 'expansion' then mrr_change else 0 end) as expansion_mrr,\n        sum(case when movement_type = 'contraction' then abs(mrr_change) else 0 end) as contraction_mrr,\n        sum(case when movement_type = 'churn' then mrr_last_month else 0 end) as churned_mrr,\n        sum(case when movement_type = 'retained' then mrr_this_month else 0 end) as retained_mrr,\n\n        -- total MRR (sum of all users with MRR > 0 this month)\n        sum(case when mrr_this_month > 0 then mrr_this_month else 0 end) as total_mrr,\n        sum(case when mrr_last_month > 0 then mrr_last_month else 0 end) as prior_month_mrr\n\n    from mrr_changes\n    where movement_type != 'inactive'  -- exclude users with no MRR in both months\n    group by month_date\n\n),\n\n-- Calculate growth rates and net change\nfinal as (\n\n    select\n        month_date,\n\n        -- customer counts\n        new_customers,\n        expansion_customers,\n        contraction_customers,\n        churned_customers,\n        retained_customers,\n        reactivated_customers,\n        new_customers + expansion_customers + contraction_customers + churned_customers + retained_customers as total_customers,\n\n        -- MRR amounts\n        new_mrr,\n        expansion_mrr,\n        contraction_mrr,\n        churned_mrr,\n        retained_mrr,\n        total_mrr,\n        prior_month_mrr,\n\n        -- net change\n        new_mrr + expansion_mrr - contraction_mrr - churned_mrr as net_mrr_change,\n\n        -- growth rates\n        case \n            when prior_month_mrr > 0 \n            then (new_mrr + expansion_mrr - contraction_mrr - churned_mrr) / prior_month_mrr * 100\n            else null\n        end as mrr_growth_rate,\n\n        case\n            when prior_month_mrr > 0\n            then churned_mrr / prior_month_mrr * 100\n            else null\n        end as churn_rate\n\n    from monthly_movements\n\n)\n\nselect * from final\norder by month_date", "relation_name": "\"analytics\".\"main\".\"rpt_mrr_movements\"", "batch_results": null}], "elapsed_time": 0.16922903060913086, "args": {"favor_state": false, "introspect": true, "use_colors_file": true, "indirect_selection": "eager", "require_unique_project_resource_names": false, "partial_parse_file_diff": true, "profiles_dir": "/Users/hazeldonaldson/.dbt", "print": true, "upload_to_artifacts_ingest_api": false, "use_colors": true, "log_level_file": "debug", "defer": false, "require_explicit_package_overrides_for_builtin_materializations": true, "require_nested_cumulative_type_params": false, "static_parser": true, "require_all_warnings_handled_by_warn_error": false, "source_freshness_run_project_hooks": true, "printer_width": 80, "log_file_max_bytes": 10485760, "require_batched_execution_for_custom_microbatch_strategy": false, "state_modified_compare_vars": false, "send_anonymous_usage_stats": true, "state_modified_compare_more_unrendered_values": false, "log_format_file": "debug", "exclude": [], "use_fast_test_edges": false, "show_resource_report": false, "require_resource_names_without_spaces": true, "empty": false, "log_path": "/Users/hazeldonaldson/Documents/saas-analytics-platform/dbt/logs", "project_dir": "/Users/hazeldonaldson/Documents/saas-analytics-platform/dbt", "macro_debugging": false, "select": ["rpt_mrr_movements"], "strict_mode": false, "cache_selected_only": false, "require_ref_searches_node_package_before_root": false, "skip_nodes_if_on_run_start_fails": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "version_check": true, "require_generic_test_arguments_property": true, "write_json": true, "invocation_command": "dbt run --select rpt_mrr_movements", "log_format": "default", "which": "run", "vars": {}, "show_all_deprecations": false, "populate_cache": true, "log_level": "info", "quiet": false, "validate_macro_args": false, "require_yaml_configuration_for_mf_time_spines": false, "partial_parse": true}}