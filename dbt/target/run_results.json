{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.11.4", "generated_at": "2026-02-19T16:55:16.282659Z", "invocation_id": "31eb091c-bb17-41f8-b776-4d24f82f7caf", "invocation_started_at": "2026-02-19T16:55:15.394372Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-19T16:55:16.177338Z", "completed_at": "2026-02-19T16:55:16.182530Z"}, {"name": "execute", "started_at": "2026-02-19T16:55:16.182726Z", "completed_at": "2026-02-19T16:55:16.278554Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.10183596611022949, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.saas_analytics.rpt_user_engagement_score", "compiled": true, "compiled_code": "\n\nwith users as (\n    select * from \"analytics\".\"main\".\"dim_users\"\n),\n\nactivity as (\n    select * from \"analytics\".\"main\".\"fct_user_activity_by_date\"\n),\n\nevents as (\n    select * from \"analytics\".\"main\".\"fct_events\"\n),\n\n--get the latest date in the data to use as \"today\"\ndata_date_range as (\n    select\n        max(user_activity_date) as latest_date\n    from activity\n),\n\n--calculate activity metrics per user\nuser_activity_metrics as (\n    select \n        user_id,\n\n        --overall activity\n        count(distinct a.user_activity_date) as total_active_days,\n        min(a.user_activity_date) as first_active_date,\n        max(a.user_activity_date) as last_active_date,\n        datediff('day', min(a.user_activity_date), max(a.user_activity_date)) + 1 as activity_span_days,\n\n        --recent activity (last 30 days)\n        count(distinct case\n            when a.user_activity_date >= d.latest_date - interval '30 days'\n            then a.user_activity_date\n        end) as active_days_l30d,\n\n        count(distinct case\n            when a.user_activity_date >= d.latest_date - interval '7 days'\n            then a.user_activity_date\n        end) as active_days_l7d,\n\n        --weekly activity rate\n        count(distinct case\n            when a.user_activity_date >= d.latest_date - interval '30 days'\n            then a.user_activity_date\n            end)::float / 30 * 7 as avg_days_per_week_l30d\n    from activity a\n    cross join data_date_range d \n    group by a.user_id, d.latest_date\n),\n\n--calculate event diversity (breadth of engagement)\nuser_event_diversity as (\n    select \n        e.user_id,\n        count(distinct e.event_name) as unique_events_all_time,\n        count(*) as total_events_all_time,\n\n        --last 30 days\n        count(distinct case\n            when e.event_at >= d.latest_date - interval '30 days'\n            then e.event_name\n        end) as unique_events_l30d,\n\n        count(distinct case\n            when e.event_at >= d.latest_date - interval '30 days'\n            then 1\n        end) as total_events_l30d\n    from events e \n    cross join data_date_range d \n    where e.event_at is not null \n    group by e.user_id, d.latest_date\n),\n\n--combine metrics and calculate engagement score\nuser_engagement as (\n    select \n        u.user_id,\n        u.signed_up_at,\n        u.acquisition_channel,\n        u.is_currently_subscribed,\n        u.user_lifecycle_stage,\n\n        --activity metrics\n        coalesce(am.total_active_days, 0) as total_active_days,\n        coalesce(am.active_days_l30d, 0) as active_days_l30d,\n        coalesce(am.active_days_l7d, 0) as active_days_l7d,\n        coalesce(am.avg_days_per_week_l30d, 0) as avg_days_per_week_l30d,\n        am.first_active_date,\n        am.last_active_date,\n        am.activity_span_days,\n\n        --event metrics\n        coalesce(ed.unique_events_all_time, 0) as unique_events_all_time,\n        coalesce(ed.total_events_all_time, 0) as total_events_all_time,\n        coalesce(ed.unique_events_l30d, 0) as unique_events_l30d,\n        coalesce(ed.total_events_l30d, 0) as total_events_l30d,\n\n        --DAU/WAU/MAU classification\n        case \n            when coalesce(am.active_days_l7d, 0) >= 1 then 'WAU'\n            when coalesce(am.active_days_l30d, 0) >= 1 then 'MAU'\n            else 'Dormant'\n        end as activity_status,\n\n        --engagement score (0-100)\n        --formula: (recency * 30) + (frequency * 40) + (breadth * 30)\n        least(100, (\n            --recency: active in the last 7 days = 30 pts, last 30 days = 15 pts\n            case \n                when coalesce(am.active_days_l7d, 0) >= 1 then 30\n                when coalesce(am.active_days_l30d, 0) >= 1 then 15\n                else 0\n            end +\n            --frequency: days active in the last 30 days (max 40 pts)\n            least(40, coalesce(am.active_days_l30d, 0) * 1.33) +\n            --breadth: unique events in the last 30 days (max 30 pts)\n            least(30, coalesce(ed.unique_events_l30d, 0) * 6)\n        )) as engagement_score,\n\n        --engagement tier\n        case \n            when least(100, (\n                case\n                    when coalesce(am.active_days_l7d, 0) >= 1 then 30\n                    when coalesce(am.active_days_l30d, 0) >= 1 then 15 \n                    else 0\n                end + \n                least(40, coalesce(am.active_days_l30d, 0) * 1.33) +\n                least(30, coalesce(ed.unique_events_l30d, 0) * 6)\n            )) >= 70 then 'High Engagement'\n            when least(100, (\n                case\n                    when coalesce(am.active_days_l7d, 0) >= 1 then 30\n                    when coalesce(am.active_days_l30d, 0) >= 1 then 15\n                    else 0\n                end +\n                least(40, coalesce(am.active_days_l30d, 0) * 1.33) +\n                least(30, coalesce(ed.unique_events_l30d, 0) * 6)\n            )) >= 40 then 'Medium Engagement'\n            when least(100, (\n                case \n                    when coalesce(am.active_days_l7d, 0) >= 1 then 30\n                    when coalesce(am.active_days_l30d, 0) >= 1 then 15\n                    else 0\n                end +\n                least(40, coalesce(am.active_days_l30d, 0) * 1.33) +\n                least(30, coalesce(ed.unique_events_l30d, 0) * 6)\n            )) > 0 then 'Low Engagement'\n            else 'Dormant'\n        end as engagement_tier,\n\n        --recency\n        case\n            when am.last_active_date is null then null \n            else datediff('day', am.last_active_date, current_date)\n        end as days_since_last_active\n    from users u \n    left join user_activity_metrics am \n        on u.user_id = am.user_id \n    left join user_event_diversity ed \n        on u.user_id = ed.user_id \n)\n\nselect * from user_engagement", "relation_name": "\"analytics\".\"main\".\"rpt_user_engagement_score\"", "batch_results": null}], "elapsed_time": 0.19147801399230957, "args": {"introspect": true, "show_all_deprecations": false, "version_check": true, "log_file_max_bytes": 10485760, "log_level_file": "debug", "use_fast_test_edges": false, "indirect_selection": "eager", "require_yaml_configuration_for_mf_time_spines": false, "defer": false, "invocation_command": "dbt run --select rpt_user_engagement_score", "macro_debugging": false, "require_nested_cumulative_type_params": false, "require_resource_names_without_spaces": true, "static_parser": true, "state_modified_compare_vars": false, "validate_macro_args": false, "quiet": false, "empty": false, "require_explicit_package_overrides_for_builtin_materializations": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "log_level": "info", "select": ["rpt_user_engagement_score"], "populate_cache": true, "profiles_dir": "/Users/hazeldonaldson/.dbt", "cache_selected_only": false, "partial_parse": true, "partial_parse_file_diff": true, "print": true, "write_json": true, "require_batched_execution_for_custom_microbatch_strategy": false, "require_generic_test_arguments_property": true, "favor_state": false, "project_dir": "/Users/hazeldonaldson/Documents/saas-analytics-platform/dbt", "require_unique_project_resource_names": false, "vars": {}, "exclude": [], "log_format_file": "debug", "log_path": "/Users/hazeldonaldson/Documents/saas-analytics-platform/dbt/logs", "require_ref_searches_node_package_before_root": false, "source_freshness_run_project_hooks": true, "log_format": "default", "send_anonymous_usage_stats": true, "which": "run", "skip_nodes_if_on_run_start_fails": false, "use_colors": true, "show_resource_report": false, "state_modified_compare_more_unrendered_values": false, "strict_mode": false, "printer_width": 80, "use_colors_file": true, "require_all_warnings_handled_by_warn_error": false, "upload_to_artifacts_ingest_api": false}}